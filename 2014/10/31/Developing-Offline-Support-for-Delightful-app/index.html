<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Developing Offline Support for Delightful App | Delightful App Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Offline photos browsing has been one of the features I have planned since the beginning for Delightful app. Core Data was of course the first thing I considered. However, since I use Mantle to simplif">
<meta property="og:type" content="article">
<meta property="og:title" content="Developing Offline Support for Delightful App">
<meta property="og:url" content="http://delightfulapp.github.io/blog/2014/10/31/Developing-Offline-Support-for-Delightful-app/">
<meta property="og:site_name" content="Delightful App Blog">
<meta property="og:description" content="Offline photos browsing has been one of the features I have planned since the beginning for Delightful app. Core Data was of course the first thing I considered. However, since I use Mantle to simplif">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Developing Offline Support for Delightful App">
<meta name="twitter:description" content="Offline photos browsing has been one of the features I have planned since the beginning for Delightful app. Core Data was of course the first thing I considered. However, since I use Mantle to simplif">

  
    <link rel="alternative" href="/atom.xml" title="Delightful App Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<div class="profilepic">
			<img src="http://www.getdelightfulapp.com/img/delightful-icon-small.png">
		</div>

		<hgroup>
		  <h1 class="header-author"><a href="/">Delightful for iPhone</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Free and Open Source Trovebox client for iPhone. <a href="http://getdelightfulapp.com">More info here</a>.</p>
		

		

		<div class="switch-area">
			<section class="first-part">
				<nav class="header-menu">
					
						<div class="appstore"><a href="https://itunes.apple.com/us/app/delightful-trovebox-photo/id878230610?ls=1&amp;mt=8"><img src="http://f.cl.ly/items/163M0N1h0o2v24362I1E/availableontheappstore.png"></a></div>
					
					<ul>
					
					</ul>
				</nav>
				<nav class="header-nav">
					<div class="social">
						
							<a class="github" target="_blank" href="https://github.com/delightfulapp/delightful" title="github">github</a>
				        
							<a class="twitter" target="_blank" href="https://twitter.com/delightfulapp" title="twitter">twitter</a>
				        
							<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
				        
					</div>
				</nav>
			</section>
			
			
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay"></div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://www.getdelightfulapp.com/img/delightful-icon-small.png">
			</div>

			<hgroup>
			  <h1 class="header-author"><a href="/">Delightful for iPhone</a></h1>
			</hgroup>
			
			<p class="header-subtitle">Free and Open Source Trovebox client for iPhone. <a href="http://getdelightfulapp.com">More info here</a>.</p>
			
			<nav class="header-menu">
				
						<div class="appstore"><a href="https://itunes.apple.com/us/app/delightful-trovebox-photo/id878230610?ls=1&amp;mt=8"><img src="http://f.cl.ly/items/163M0N1h0o2v24362I1E/availableontheappstore.png"></a></div>
					
				<ul>
				
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/delightfulapp/delightful" title="github">github</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/delightfulapp" title="twitter">twitter</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <article id="post-Developing-Offline-Support-for-Delightful-app" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/10/31/Developing-Offline-Support-for-Delightful-app/" class="article-date">
  	<time datetime="2014-10-31T10:25:16.000Z" itemprop="datePublished">Oct 31 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/development/">development</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Developing Offline Support for Delightful App
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Offline photos browsing has been one of the features I have planned since the beginning for Delightful app. Core Data was of course the first thing I considered. However, since I use <a href="https://github.com/Mantle/Mantle" target="_blank" rel="external">Mantle</a> to simplify the model layer and JSON serialization, I couldn’t figure out a simple way to mix it with Core Data. In the first version of the app I ended up using simple cache mechanism using <a href="https://github.com/tumblr/TMCache" target="_blank" rel="external">TMCache</a>. But the performance was not so good especially when caching thousand of photos.</p>
<a id="more"></a>

<p>I tried using <a href="http://realm.io" target="_blank" rel="external">Realm database</a> when it became popular. Unfortunately I need to subclass <code>RLMObject</code> for my models and I was reluctant to replace Mantle. I also hit a problem where the database size increases exponentially when using Realm (although they claimed that <a href="https://twitter.com/realm/status/521884663313211392" target="_blank" rel="external">this issue has been fixed</a>). After that I considered of using SQL via Marco Arment’s <a href="https://github.com/marcoarment/FCModel" target="_blank" rel="external">FCModel</a>. But then somebody mentioned about <a href="https://github.com/yapstudios/YapDatabase" target="_blank" rel="external">YapDatabase</a>.</p>
<p>YapDatabase has one feature that I love instantly which is I can keep using my model class without subclassing any specific classes. I can keep using Mantle and my objects can be stored to database. YapDatabase also has splendid <a href="https://github.com/yapstudios/YapDatabase/wiki" target="_blank" rel="external">documentations</a>. Another thing I like from YapDatabase is how it is designed to help developing iOS app faster by not only tackling the database part but also its interaction with the user interface. </p>
<p>YapDatabase has an interesting extension called Views to display data from database. A View is basically a table in database. We provide grouping/filtering and sorting block when initializing a View to sort, filter, and group data from database. After registering this View to the database, anytime we insert new object to the database, the grouping/filtering and sorting block will be triggered and the reference to that object will be stored in the View’s table in database. For example in Delightful app, I register a View for each of the albums so that when a <code>Photo</code> object is inserted to database, it will also be “saved” to the album Views it belongs to. And if I want to display photos in an album, I can just load the album View and the photos will appear <em>almost</em> instantly.</p>
<p>There is a problem with YapDatabase’s View registration. It enumerates the database to populate View. In result, it takes a few seconds to complete when there are tons of photos in database. In iPhone 5s with 7000 photos in database, it took around 10 seconds to register a View to show photos in an album. I already asked for tips from YapDatabase developer to speed up View registration, and he said <a href="https://github.com/yapstudios/YapDatabase/issues/124" target="_blank" rel="external">skipping initial View population</a> is in todo list.</p>
<p>In the mean time, I design the app to fetch albums and tags first before fetching photos, then create a View for each of the albums and each of the tags during first launch. And since there are no photos yet, the initial View population completes quickly. The problem is of course when there are already many photos in database and the app receives a new album. But I figure I can inform user that the app is preparing database or something.</p>
<p>The app still needs some UI tweaks to support iOS 8. I’ll submit it as soon as I’m done with it. Uploading feature is postponed until offline feature is live in the app store.</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/11/30/Multiple-photos-selection-for-Delightful-Upload-feature/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          Multiple Photos Selection for Delightful Upload Feature
        
      </div>
    </a>
  
  
</nav>

  
</article>






      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Delightful for iPhone
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

  <script src="/js/main.js" type="text/javascript"></script>


  </div>
</body>
</html>